<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>Cinder</title>
		<link rel="stylesheet" href="cinder_doxygen.css" type="text/css" media="screen" />
		<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="jquery.lightbox-0.5.pack.js"></script>		
	</head>
<body>	
<div class="wrapper">
	<div id="header">
		<h1><a href="http://libcinder.org">Cinder</a></h1>
	</div>

<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Guide to Saving QuickTime Movies </h1>  </div>
</div>
<div class="contents">
<h2>Introduction</h2>
<p>Cinder makes writing QuickTime movies a straightforward task via the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> class. Creating a basic QuickTime movie is easy, and <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> also exposes more advanced options which allow you to take full advantage of the features of modern codecs like <a href="http://en.wikipedia.org/wiki/H.264/MPEG-4_AVC">H.264</a>. <br/>
 </p>
<h2>Creating a Simple Movie</h2>
<p>To setup an instance of <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a>, we'll need to know two things: the path where we'd like to create the movie, and its dimensions in pixels. As an example, we'll imagine we'd like to create a movie called <em>myMovie.mov</em> and we'd like it saved into our user documents directory. We'll also assume the movie is 640x480 pixels.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="_movie_writer_8h.html">cinder/qtime/MovieWriter.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="_utilities_8h.html">cinder/Utilities.h</a>&quot;</span>
<span class="keyword">using namespace </span><a class="code" href="_cinder_8h.html#ad7c72989de97de796f20842b495a71f7">ci</a>;

qtime::MovieWriter movie( <a class="code" href="namespacecinder.html#a8ee8b600e38fb7c3d04945c7a678e661" title="Returns a path to the user&amp;#39;s documents directory.">getDocumentsDirectory</a>() + <span class="stringliteral">&quot;myMovie.mov&quot;</span>, 640, 480 );
</pre></div><p> <br/>
 Because we have not specified any additional parameters, the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> defaults to using a PNG codec, and will run at 30 frames per second. Now let's imagine we have a rendering loop which will create an animation 100 frames long. We'll assume we have a routine called <code>renderFrame()</code> which has a parameter for providing which frame we need, and it returns a <a class="el" href="classcinder_1_1_surface_t.html">Surface</a>. Continuing where we left off, here's how we might put the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> to use: </p>
<div class="fragment"><pre class="fragment"><a class="code" href="namespacecinder.html#a7f62055e4cb811edb9868b32595a1d64">Surface</a> renderFrame( <span class="keywordtype">int</span> frame ); <span class="comment">// defined elsewhere</span>

<span class="keywordflow">for</span>( <span class="keywordtype">int</span> frame = 0; frame &lt; 100; ++frame ) {
    movie.addFrame( renderFrame( frame ) );
}
</pre></div><p> <br/>
 For the basic use case, that's all there is to it - we simply call <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html#ab0e78cf4f22cf5ce4dd9db87ba34b9e9">addFrame()</a> with our Surface inside the loop. When the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> goes out of scope, it will save all its frames to disk. Alternatively, to explicitly force the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> to save, call <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html#a00c46b387ad4fb0d1fea32668170694d">finish()</a>: </p>
<div class="fragment"><pre class="fragment">movie.finish();
</pre></div><p> <br/>
 </p>
<h2>Specifying Formats</h2>
<p>The <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> class offers extensive options for customizing the format of its output, and this can be done using the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> class. Here's an example of how to modify the codec to be <code>JPEG</code> and the quality to 50%: </p>
<div class="fragment"><pre class="fragment">qtime::MovieWriter::Format format;
format.setCodec( qtime::MovieWriter::CODEC_JPEG );
format.setQuality( 0.5f );
qtime::MovieWriter movie( <a class="code" href="namespacecinder.html#a8ee8b600e38fb7c3d04945c7a678e661" title="Returns a path to the user&amp;#39;s documents directory.">getDocumentsDirectory</a>() + <span class="stringliteral">&quot;myMovie.mov&quot;</span>, 640, 480, format );
</pre></div><p> <br/>
 The first call, <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html#a08a2b918227f2a0a6eaf1f7c7017586f">setCodec()</a>, allows users to provide a constant from among several <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html#a991026ce302d3e722d420c8d0acf5433a621b453377233c619ec2aed289a6f2e9">defined for popular codecs</a> or the four character identifier as specified by QuickTime in its header file <code>ImageCompression.h</code>. The second call, <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html#a4d4402b55ab8e4b8dafc76b37f75025e">setQuality()</a> allows the specification of a level of quality ranging from the lowest, <code>0.0</code> to the highest, <code>1.0</code> (which for some codecs is lossless). The <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> class also allows the chaining of several calls as a convenience, which looks like this: </p>
<div class="fragment"><pre class="fragment">qtime::MovieWriter movie( <a class="code" href="namespacecinder.html#a8ee8b600e38fb7c3d04945c7a678e661" title="Returns a path to the user&amp;#39;s documents directory.">getDocumentsDirectory</a>() + <span class="stringliteral">&quot;myMovie.mov&quot;</span>,
                            640, 480, qtime::MovieWriter::Format().setCodec( <span class="stringliteral">&#39;png &#39;</span> ).setQuality( 0.95f ) );
</pre></div><p> <br/>
 </p>
<h2>MultiPass Encoding</h2>
<p>The documentation for qtime::MovieWriter::Format provides a more thorough list of its options, but a key principle is that the default settings will achieve the best possible quality with one exception: multiPass encoding is not enabled by default. This is a technique which allows QuickTime to make several passes over the frames' data, and can result in much higher quality output. At the time of this writing, only the H.264 codec can make use of the technique. However this is not enabled by default because it can result in a lengthy postprocessing phase, and it requires the creation of two temporary files. The first of these files QuickTime creates for its own purposes, and the second <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> makes to store temporary copies of all frames supplied by calls to <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html#ab0e78cf4f22cf5ce4dd9db87ba34b9e9">addFrame()</a>. However all of this is handled automatically when multiPass encoding is enabled via <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html#a128666c829fb5b5d6c526a68d1405914">qtime::MovieWriter::Format::enableMultiPass()</a>. <br/>
 </p>
<h2>User Compression Options</h2>
<p>QuickTime provides a standard user interface for specifying encoding options, and Cinder makes this available via the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html#aaae6074825b2e8acfdfec51124ad4675">qtime::MovieWriter::getUserCompressionSettings</a> function. This function can be used to populate a <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> instance. Also note that the resulting instance may contain additional settings that <a class="el" href="classcinder_1_1qtime_1_1_movie_writer_1_1_format.html">qtime::MovieWriter::Format</a> does not provide direct functions for manipulating. An optional parameter allows the specification of a preview image for the dialog. </p>
<div class="fragment"><pre class="fragment"><a class="code" href="namespacecinder.html#a7f62055e4cb811edb9868b32595a1d64">Surface</a> previewImage( <a class="code" href="namespacecinder.html#a5091cf493eafbd8741669dfac5188856" title="Loads an image from the file path path. Optional extension parameter allows specification of a file t...">loadImage</a>( <a class="code" href="namespacecinder_1_1app.html#a93522b1858f745f7d9438d6d124ae11b" title="Returns a DataSource to an application resource. On Mac OS X, macPath is a path relative to the bundl...">loadResource</a>( RES_PREVIEW_IMAGE ) ) );
qtime::MovieWriter::Format format;
<span class="keywordflow">if</span>( qtime::MovieWriter::getUserCompressionSettings( &amp;format, previewImage ) ) {
    mMovieWriter = qtime::MovieWriter( path, <a class="code" href="namespacecinder_1_1app.html#ac8c6ecaf9d91c5eedfd6b127a60e939d" title="Returns the width of the active App&amp;#39;s window measured in pixels, or the screen when in full-scree...">getWindowWidth</a>(), <a class="code" href="namespacecinder_1_1app.html#a71d6248e05c9a15ad660a5243da38a70" title="Returns the height of the active App&amp;#39;s window measured in pixels, or the screen when in full-scre...">getWindowHeight</a>(), format );
}
</pre></div><p> <br/>
 </p>
<div align="center">
<img src="qtime\MovieWriter\qtime_settings.png" alt="qtime_settings.png"/>
</div>
<p> <br/>
 </p>
<h2>Issues</h2>
<p>There are a couple of known issues we're still looking into in the <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> class. The first is that there is a visible gamma shift (things get brighter and desaturated) with certain codecs, including H.264. This seems to be a pervasive problem with QuickTime, and one which video encoding even with Apple's own QuickTime Player suffers from. There are numerous discussions of the issue on the internet, and we have yet to find a solution, unfortunately. <br/>
<br/>
 Also currently <a class="el" href="classcinder_1_1qtime_1_1_movie_writer.html">qtime::MovieWriter</a> does not support audio exporting, and this will be introduced in future revisions. </p>
</div>
	<div class="footer">
		<p> </p>
	</div>
</div>	
</body>
</html>
